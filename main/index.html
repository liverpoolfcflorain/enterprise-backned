<html lang="en">    
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="../style/start.css">
        <title>investomania</title> 
    </head>
    <body>
       
        <div class="logo">
            <button class="logo-button">
                <img src="../pictures/abc.jpg" alt="Logo" class="logo-image">
            </button>
        </div>
        <div class="username-div"> 
            <input type="text" placeholder="username" class="username" id="username">
        </div>
        <div class="password-div"> 
            <input type="password" placeholder="password" class="password" id="password">
        </div>
    
        <div class="start">
            <button class="start-button" onclick="check()" >
                <h2>login</h2>
            </button>
        </div>
        <div class="error" id="error"></div>
        <div class="success" id="success"></div>
        <script>
const api = 'http://localhost:3000';

async function getLogin() {
  try {
    const response = await fetch(`${api}/login-info`);
    const data = await response.json();
    console.log('Login data received:', data);
    return data;
  } catch (error) {
    console.error('Error fetching login data:', error);
    document.getElementById('error').textContent = 'Failed to connect to server';
    return [];
  }
}

async function check() {
  const username = document.getElementById('username').value.trim();
  const password = document.getElementById('password').value.trim();
  
  const errorEl = document.getElementById('error');
  const successEl = document.getElementById('success');

  // Clear previous messages
  errorEl.textContent = '';
  successEl.textContent = '';
  
  // Validation
  if (!username || !password) {
    errorEl.textContent = 'Please enter both username and password';
    return;
  }

  try {
    const data = await getLogin();
    
    // Check credentials
    let validLogin = false;
    let userMongoId = null;
    
    for (let i = 0; i < data.length; i++) {
      console.log('Checking:', data[i].username);
      
      if (username === data[i].username && password === data[i].password) {
        validLogin = true;
        userMongoId = data[i]._id; // Get the MongoDB _id
        successEl.textContent = 'Login successful! Redirecting...';
        
        // Store user ID in sessionStorage
        sessionStorage.setItem('userId', userMongoId);
        
        console.log('User MongoDB ID:', userMongoId);
        
        // Redirect with userId as URL parameter (using MongoDB _id)
        setTimeout(() => {
          window.location.href = `main.html?userId=${encodeURIComponent(userMongoId)}`;
        }, 500);
        
        return;
      }
    }
    
    // Invalid credentials
    if (!validLogin) {
      errorEl.textContent = 'Invalid username or password';
      console.log('Invalid credentials');
    }
    
  } catch (error) {
    console.error('Login error:', error);
    errorEl.textContent = 'Login failed. Please try again.';
  }
}
</script>
      
        
    </body>
</html>
